<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<meta name="description"
		content="Trang tin điện tử hàng đầu với nội dung đa dạng, cập nhật tin tức mới nhất 24/7" />
	<meta name="author" content="Nguyễn Hoàng Tùng" />
	<title>
		<%= title %> - tNews | Trang tin điện tử hàng đầu
	</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<!-- <link href="https://trangtin-2jwy.onrender.com/css/app.css" rel="stylesheet" /> -->
	<style>
		:root {
			--primary-color: #2563eb;
			--secondary-color: #1e40af;
			--dark-color: #1e293b;
			--light-color: #f8fafc;
			--gray-color: #64748b;
			--border-radius: 8px;
			--box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
			--transition: all 0.3s ease;
		}

		body {
			font-family: 'Inter', sans-serif;
			color: var(--dark-color);
			background-color: #f5f7fa;
			line-height: 1.6;
		}

		/* Navigation */
		.navbar {
			box-shadow: var(--box-shadow);
			padding: 1rem 0;
			background-color: white !important;
		}

		.navbar-brand {
			font-weight: 700;
			font-size: 1.75rem;
			color: var(--primary-color);
			transition: var(--transition);
		}

		.navbar-brand:hover {
			color: var(--secondary-color);
		}

		.nav-link {
			font-weight: 500;
			padding: 0.5rem 1rem;
			border-radius: var(--border-radius);
			transition: var(--transition);
		}

		.nav-link:hover {
			color: var(--primary-color);
			background-color: rgba(37, 99, 235, 0.1);
		}

		.dropdown-menu {
			border: none;
			box-shadow: var(--box-shadow);
			border-radius: var(--border-radius);
		}

		.dropdown-item {
			padding: 0.5rem 1rem;
			transition: var(--transition);
		}

		.dropdown-item:hover {
			background-color: rgba(37, 99, 235, 0.1);
			color: var(--primary-color);
		}

		.search {
			border-radius: 50px;
			padding: 0.5rem 1rem;
			border: 1px solid #e2e8f0;
			transition: var(--transition);
		}

		.search:focus {
			border-color: var(--primary-color);
			box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
		}

		.card {
			border: none;
			border-radius: var(--border-radius);
			box-shadow: var(--box-shadow);
			transition: var(--transition);
			overflow: hidden;
			margin-bottom: 1.5rem;
		}

		.card:hover {
			transform: translateY(-5px);
			box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
		}

		.card-img {
			height: 200px;
			object-fit: cover;
			transition: var(--transition);
		}

		.card:hover .card-img {
			opacity: 0.9;
		}

		.card-header {
			background-color: white;
			border-bottom: 1px solid #e2e8f0;
		}

		.card-title {
			font-weight: 600;
			margin-bottom: 0.75rem;
			transition: var(--transition);
		}

		.card-title:hover {
			color: var(--primary-color);
		}

		.card-meta {
			font-size: 0.875rem;
			color: var(--gray-color);
			margin-bottom: 0.5rem;
		}

		.btn-light {
			background-color: #f1f5f9;
			border-color: #e2e8f0;
			transition: var(--transition);
		}

		.btn-light:hover {
			background-color: #e2e8f0;
		}

		.pagination .page-item .page-link {
			border-radius: var(--border-radius);
			margin: 0 0.25rem;
			border: none;
			color: var(--gray-color);
			font-weight: 500;
			transition: var(--transition);
		}

		.pagination .page-item.active .page-link {
			background-color: var(--primary-color);
			color: white;
		}

		.pagination .page-item .page-link:hover {
			color: var(--primary-color);
			background-color: rgba(37, 99, 235, 0.1);
		}

		.site-newsletter {
			background-color: var(--primary-color);
			color: white;
			padding: 3rem 0;
		}

		.site-newsletter .form-control {
			border-radius: 50px 0 0 50px;
			border: none;
			height: 45px;
		}

		.site-newsletter .btn-secondary {
			border-radius: 0 50px 50px 0;
			background-color: var(--secondary-color);
			border: none;
			height: 45px;
			padding: 0 1.5rem;
		}

		.site-newsletter .btn-secondary:hover {
			background-color: #1e3a8a;
		}

		.site-instagram {
			position: relative;
			overflow: hidden;
		}

		.site-instagram .action {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 2;
		}

		.site-instagram .photo {
			display: block;
			position: relative;
			overflow: hidden;
		}

		.site-instagram .photo:after {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.3);
			transition: var(--transition);
			opacity: 0;
		}

		.site-instagram .photo:hover:after {
			opacity: 1;
		}

		.site-instagram .photo img {
			transition: var(--transition);
		}

		.site-instagram .photo:hover img {
			transform: scale(1.05);
		}

		.site-footer {
			color: white;
			padding: 3rem 0;
		}

		.site-footer .nav-link {
			color: rgba(255, 255, 255, 0.8);
			padding: 0.5rem 1rem;
		}

		.site-footer .nav-link:hover {
			color: white;
			background-color: transparent;
		}

		.copy {
			text-align: center;
			margin-top: 2rem;
			color: rgba(255, 255, 255, 0.6);
		}

		@media (max-width: 768px) {
			.navbar-brand {
				font-size: 1.5rem;
			}

			.card-img {
				height: 150px;
			}

			.site-instagram .action {
				position: relative;
				transform: none;
				text-align: center;
				margin-bottom: 1rem;
			}
		}
	</style>
</head>

<body>

	<%- include('navbar') %>

		<main class="main pt-1 mt-1">
			<div class="container">
				<!-- Breaking News Banner -->
				<!-- <div class="breaking-news bg-primary text-white rounded">
				</div> -->

				<div class="text-center">
					<span class="text-muted">Chuyên mục:</span>
					<h3>
						<%= (typeof chude !=="undefined" ) ? chude.TenChuDe : 'N/A' %>
					</h3>
					<hr />
				</div>

				<div class="row">
					<div class="col-lg-8">
						<!-- Featured Post -->
						<% if(typeof featuredPost !=="undefined" && featuredPost.length> 0) { %>
							<div class="card mb-4 border-0 shadow-sm">
								<div class="row g-0">
									<div class="col-md-6">
										<img src="<%- firstImage(featuredPost[0].NoiDung) %>"
											class="img-fluid rounded-start h-100" alt="<%= featuredPost[0].TieuDe %>">
									</div>
									<div class="col-md-6">
										<div class="card-body">
											<span class="badge bg-danger mb-2">NỔI BẬT</span>
											<h2 class="card-title"><a href="/baiviet/chitiet/<%= featuredPost[0]._id %>"
													class="text-dark text-decoration-none">
													<%= featuredPost[0].TieuDe %>
												</a></h2>
											<p class="card-text">
												<%= featuredPost[0].TomTat %>
											</p>
											<div class="d-flex align-items-center mt-3">
												<small class="text-muted me-3"><i class="far fa-clock me-1"></i>
													<%= formatDate(featuredPost[0].NgayDang) %>
												</small>
												<small class="text-muted"><i class="far fa-eye me-1"></i>
													<%= featuredPost[0].LuotXem || 0 %> lượt xem
												</small>
											</div>
										</div>
									</div>
								</div>
							</div>
							<% } %>

								<!-- Category Tabs -->
								<!-- <ul class="nav nav-tabs mb-4" id="categoryTabs" role="tablist">
									<li class="nav-item" role="presentation">
										<button class="nav-link active" id="all-tab" data-bs-toggle="tab"
											data-bs-target="#all" type="button" role="tab">Tất cả</button>
									</li>
									<% if(typeof chuyenmuc !=="undefined" ) { chuyenmuc.slice(0, 4).forEach((cd,
										index)=> {
										%>
										<li class="nav-item" role="presentation">
											<button class="nav-link" id="cat<%= index %>-tab" data-bs-toggle="tab"
												data-bs-target="#cat<%= index %>" type="button" role="tab">
												<%= cd.TenChuDe %>
											</button>
										</li>
										<% }); } %>
								</ul> -->

								<!-- Tab Content -->
								<div class="tab-content" id="categoryTabContent">
									<!-- All Posts Tab -->
									<div class="tab-pane fade show active" id="all" role="tabpanel">
										<div class="row" id="postContainer">
											<% if(typeof baiviet !=="undefined" ) { baiviet.slice(0, 6).forEach(bv=> {
												%>
												<div class="col-md-6 mb-4">
													<div class="card h-100">
														<div class="position-relative">
															<img src="<%- firstImage(bv.NoiDung) %>"
																class="card-img-top" alt="<%= bv.TieuDe %>">
															<span
																class="position-absolute bottom-0 start-0 bg-primary text-white px-2 py-1">
																<%= bv.ChuDe.TenChuDe %>
															</span>
														</div>
														<div class="card-body">
															<h5 class="card-title"><a
																	href="/baiviet/chitiet/<%= bv._id %>"
																	class="text-dark text-decoration-none">
																	<%= bv.TieuDe %>
																</a></h5>
															<p class="card-text text-muted small">
																<%= bv.TomTat.length> 100 ? bv.TomTat.substring(0, 100)
																	+
																	'...' : bv.TomTat %>
															</p>
														</div>
														<div class="card-footer bg-white border-0 pt-0">
															<div
																class="d-flex justify-content-between align-items-center">
																<small class="text-muted"><i
																		class="far fa-clock me-1"></i>
																	<%= formatDate(bv.NgayDang) %>
																</small>
																<small class="text-muted"><i
																		class="far fa-eye me-1"></i>
																	<%= bv.LuotXem || 0 %>
																</small>
															</div>
														</div>
													</div>
												</div>
												<% }); } %>
										</div>
									</div>

									<!-- Category Tabs -->
									<% if(typeof chuyenmuc !=="undefined" ) { chuyenmuc.slice(0, 4).forEach((cd,
										index)=> {
										%>
										<div class="tab-pane fade" id="cat<%= index %>" role="tabpanel">
											<div class="row">
												<% if(typeof baiviet !=="undefined" ) { const
													catPosts=baiviet.filter(bv=>
													bv.ChuDe._id === cd._id).slice(0, 6);
													catPosts.forEach(bv => {
													%>
													<div class="col-md-6 mb-4">
														<div class="card h-100">
															<img src="<%- firstImage(bv.NoiDung) %>"
																class="card-img-top" alt="<%= bv.TieuDe %>">
															<div class="card-body">
																<h5 class="card-title"><a
																		href="/baiviet/chitiet/<%= bv._id %>"
																		class="text-dark text-decoration-none">
																		<%= bv.TieuDe %>
																	</a></h5>
																<p class="card-text text-muted small">
																	<%= bv.TomTat.length> 100 ? bv.TomTat.substring(0,
																		100)
																		+ '...' : bv.TomTat %>
																</p>
															</div>
															<div class="card-footer bg-white border-0 pt-0">
																<div
																	class="d-flex justify-content-between align-items-center">
																	<small class="text-muted"><i
																			class="far fa-clock me-1"></i>
																		<%= formatDate(bv.NgayDang) %>
																	</small>
																	<small class="text-muted"><i
																			class="far fa-eye me-1"></i>
																		<%= bv.LuotXem || 0 %>
																	</small>
																</div>
															</div>
														</div>
													</div>
													<% }); } %>
											</div>
										</div>
										<% }); } %>
								</div>

								<!-- Load More Button -->
								<div class="text-center mb-5">
									<button id="loadMoreBtn" class="btn btn-outline-primary px-4" data-offset="6"
										data-chude="<%= chude._id %>">Xem thêm <i
											class="fas fa-arrow-down ms-2"></i></button>
								</div>
					</div>

					<!-- Sidebar -->
					<div class="col-lg-4">
						<!-- About Widget -->
						<div class="card mb-4 shadow-sm">
							<div class="card-body text-center">
								<!-- <img src="https://via.placeholder.com/100" class="rounded-circle mb-3" alt="About tNews"> -->
								<h5 class="card-title">Giới thiệu tNews</h5>
								<p class="card-text">Trang tin tức hàng đầu với nội dung đa dạng, cập nhật tin tức mới
									nhất
									24/7. Cam kết mang đến thông tin chính xác và khách quan.</p>
								<div class="social-links mt-3">
									<% if(links) { %>
										<% if(links.facebook) { %>
											<a href="<%= links.facebook %>" class="text-primary me-3" target="_blank"><i class="fab fa-facebook-f"></i></a>
										<% } %>
										<% if(links.twitter) { %>
											<a href="<%= links.twitter %>" class="text-info me-2" target="_blank">
												<i class="fab fa-twitter"></i></a>
										<% } %>
										<% if(links.youtube) { %>
											<a href="<%= links.youtube %>" class="text-danger me-2" target="_blank">
												<i class="fab fa-youtube"></i></a>
										<% } %>
										<% if(links.linkedin) { %>
											<a href="<%= links.linkedin %>" class="text-primary me-2" target="_blank">
												<i class="fab fa-linkedin-in"></i></a>
										<% } %>
										<% if(links.tiktok) { %>
											<a href="<%= links.tiktok %>" class="text-dark me-2" target="_blank">
												<i class="fab fa-tiktok"></i></a>
										<% } %>
										<% if(links.zalo) { %>
											<a href="<%= links.zalo %>" class="me-2" target="_blank">
												<img src="/images/icon_zalo.svg" alt="Zalo" style="width: 20px; height: 20px;"></a>												
										<% } %>
									<% } %>
								</div>
							</div>
						</div>

						<!-- Trending Now -->
						<div class="card mb-4 shadow-sm">
							<div class="card-header bg-white border-0">
								<h5 class="mb-0"><i class="fas fa-fire text-danger me-2"></i> Đang hot</h5>
							</div>
							<div class="card-body">
								<% if(typeof xemnhieunhat !=="undefined" ) { xemnhieunhat.slice(0, 5).forEach((bv,
									index)=>
									{ %>
									<div class="d-flex mb-3 <%= index > 0 ? 'pt-3 border-top' : '' %>">
										<div class="flex-shrink-0">
											<span
												class="bg-light text-primary rounded-circle d-flex align-items-center justify-content-center"
												style="width: 36px; height: 36px;">
												<%= index + 1 %>
											</span>
										</div>
										<div class="flex-grow-1 ms-3">
											<h6 class="mb-1"><a href="/baiviet/chitiet/<%= bv._id %>"
													class="text-dark text-decoration-none">
													<%= bv.TieuDe %>
												</a></h6>
											<small class="text-muted"><i class="far fa-clock me-1"></i>
												<%= formatDate(bv.NgayDang) %>
											</small>
										</div>
									</div>
									<% }); } %>
							</div>
						</div>

						<!-- Categories -->
						<div class="card mb-4 shadow-sm">
							<div class="card-header bg-white border-0">
								<h5 class="mb-0"><i class="fas fa-folder-open text-primary me-2"></i> Chuyên mục</h5>
							</div>
							<div class="card-body">
								<div class="d-flex flex-wrap">
									<% if(typeof chuyenmuc !=="undefined" ) { chuyenmuc.forEach(cd=> { %>
										<a href="/baiviet/chude/<%= cd._id %>"
											class="btn btn-sm btn-outline-secondary rounded-pill me-2 mb-2">
											<%= cd.TenChuDe %>
										</a>
										<% }); } %>
								</div>
							</div>
						</div>

						<!-- Newsletter -->
						<div class="card mb-4 shadow-sm border-primary">
							<div class="card-body">
								<h5 class="card-title text-primary"><i class="fas fa-envelope me-2"></i> Nhận bản tin
								</h5>
								<p class="card-text small">Đăng ký để nhận tin tức mới nhất hàng ngày vào hộp thư của
									bạn.
								</p>
								<form id="newsletterForm" class="mt-3">
									<div class="mb-3">
										<input type="email" class="form-control" id="newsletterEmail"
											placeholder="Email của bạn">
									</div>
									<button type="submit" class="btn btn-primary w-100">Đăng ký ngay</button>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>

		<%- include('footer') %>

			<!-- Back to Top Button -->
			<a href="#" class="btn btn-primary rounded-circle back-to-top"
				style="position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">
				<i class="fas fa-arrow-up"></i>
			</a>
			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
			<script>
				document.getElementById('loadMoreBtn').addEventListener('click', function () {
					const btn = this;
					const offset = parseInt(btn.getAttribute('data-offset'));
					const chudeId = btn.getAttribute('data-chude'); // lấy ID chủ đề

					fetch(`/api/xemthem_chude?offset=${offset}&chude=${chudeId}`)
						.then(res => res.json())
						.then(data => {
							if (data.length === 0) {
								btn.disabled = true;
								btn.textContent = 'Không còn bài viết';
								return;
							}

							let html = '';
							data.forEach(bv => {
								html += `
<div class="col-md-6 mb-4">
	<div class="card h-100">
		<img src="${bv.anh}" class="card-img-top" alt="${bv.tieude}">
		<div class="card-body">
			<h5 class="card-title"><a href="/baiviet/chitiet/${bv._id}" class="text-dark text-decoration-none">${bv.tieude}</a></h5>
			<p class="card-text text-muted small">${bv.tomtat}</p>
		</div>
		<div class="card-footer bg-white border-0 pt-0">
			<div class="d-flex justify-content-between align-items-center">
				<small class="text-muted"><i class="far fa-clock me-1"></i>${bv.ngaydang}</small>
				<small class="text-muted"><i class="far fa-eye me-1"></i>${bv.luotxem}</small>
			</div>
		</div>
	</div>
</div>`;
							});

							document.getElementById('postContainer').insertAdjacentHTML('beforeend', html);
							btn.setAttribute('data-offset', offset + data.length);
						});
				});

				document.getElementById('newsletterForm').addEventListener('submit', async function (e) {
					e.preventDefault();
					const email = document.getElementById('newsletterEmail').value;

					try {
						const res = await fetch('/newsletter/dangky', {
							method: 'POST',
							headers: { 'Content-Type': 'application/json' },
							body: JSON.stringify({ email })
						});

						const data = await res.json();
						alert(data.message);
					} catch (err) {
						alert('Lỗi khi gửi đăng ký');
						console.error(err);
					}
				});
			</script>
</body>

</html>